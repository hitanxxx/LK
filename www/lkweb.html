<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
		<title>LK - web</title>
		<link rel="stylesheet" href="css/mainpage.css"/>
		<script src="js/axios.min.js"></script>
		<script src="js/json.js"></script>
	</head>

	<body>
		<div id="glowall" class="glowall">
			<div id="glodec" class="glodec" ></div>
			<div id="header" class="header">
				<div id="header_main_title" class="header_main_title">
				</div>
				<div id="mySidenav" class="sidenav">
				  <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
				  <a href="index.html">home</a>
				  <a href="lktunnel.html">lk-tunnel</a>
				  <a href="lkperf.html">lk-perf</a>
				  <a href="lkweb.html">lk-web</a>
				  <a href="benchmark.html">benchmark</a>
				</div>
				<div id="menu" class="menu">
				<span style="font-size:30px;cursor:pointer" onclick="openNav()">&#9776; open</span>
				</div>
				
			</div>
			<div id="content" class="content">
				<div id="content_text" class="content_text">
				<h1>LK - WEB</h1>
				<h1>lk web 是什么</h1>

<h1>lk web 的特点</h1>

<p>lk web是一个web 服务器，除了处理静态文件。还有一些api，提供一些服务。lk perf 就是基于这些接口。关于一些特点可以从配置文件中看出来。</p>

<h1>lk web 的使用</h1>

<pre><code>	{
    &quot;daemon&quot;:false,
    &quot;worker_process&quot;:1,
    &quot;perf&quot;:false,

    &quot;log_error&quot;:true,
    &quot;log_debug&quot;:false,

    &quot;reuse_port&quot;:false,
    &quot;accept_mutex&quot;:false,

    &quot;sslcrt&quot;:&quot;/usr/local/lk/www/certificate/server.crt&quot;,
    &quot;sslkey&quot;:&quot;/usr/local/lk/www/certificate/server.key&quot;,

    &quot;http&quot;:{
            &quot;http&quot;:[9999],
            &quot;https&quot;:[],
            &quot;home&quot;:&quot;/usr/local/lk/www&quot;,
            &quot;index&quot;:&quot;index.html&quot;
    },

    &quot;!tunnel&quot;:{
            &quot;mode&quot;:&quot;single&quot;
    }</code></pre>
}</code></pre>

<p>一个典型的配置文件是这样的，可以设置 守护进程，工作进程，是否工作在perf模式， 不同等级log的开关。</p>

<ul><li>reuse port是socket的一个特性，可以在多核心的情况下，监听同一地址端口而避免进入竞争态。实现仿似跟nginx类似。默认关闭。</li><li>accept mutex则是基于信号量的accept互斥锁。实现方式跟功能都与nginx类似。reuse port 和 accept mutex 默认都是关闭的。</li><li>ssl crt和 ssl key是ssl需要的证书文件。目前版本他们是全局的。lk web https，lk perf https，lk tunnel 都会用到，会面可能会修改成局部。</li><li>http 块则设置关于http相关的信息，两个数组中包括http/https开放监听的端口。 home则是静态文件文件夹，index则是默认使用的文件。</li><li>tunnel部分可以看lk tunnel部分。</li></ul>
<p>需要注意的地方是，当 perf模式开启的时候，accept mutex 以及 reuse port全部会失效。当以 perf模式工作的时候，只有最后一个工作进程会接受http部分的设置进行监听。其他的进程则不会监听。单纯的作为perf的进程准备被投入使用。</p>

<p>在双核心的虚拟机上做了测试，accept mutex的性能是比较一般的，而且会导致多进程之间的负载不一致。 而 reuse port 开启的情况下，性能变低。关闭 accept mutex 和 reuse port，把accept互斥交给内核，这样的效率是最高的。核心之间的负载也很一致。默认采用关闭 accept mutex 和 关闭reuse port。</p>			
			</div>
				<div id="footer" class="footer" >
				<p>Powered by <a href="https://github.com/hitanxxx/lk">LK</a></p>
				</div>
			</div>	
			
		</div>
	<script>
	function openNav() {
		document.getElementById("mySidenav").style.width = "200px";
	}

	function closeNav() {
		document.getElementById("mySidenav").style.width = "0";
	}
	</script>
	</body>
</html>